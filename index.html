<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact — FormBridge</title>
  <style>
    :root{
      --bg:#f4f7fb;
      --card:#fff;
      --muted:#6b7280;
      --accent:#2563eb;
      --danger:#ef4444;
      --success:#16a34a;
      --radius:10px;
      --shadow: 0 10px 30px rgba(16,24,40,0.06);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    body{background:var(--bg);margin:0;padding:28px;display:flex;align-items:center;justify-content:center;min-height:100vh}
    .card{width:100%;max-width:720px;padding:28px;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow)}
    h2{margin:0 0 6px 0}
    p.note{margin:6px 0 18px;color:var(--muted)}
    label{display:block;margin-top:12px;font-weight:700;color:#111827}
    input,textarea{width:100%;padding:12px;margin-top:8px;border-radius:8px;border:1px solid #e6e9ef;background:#fbfdff;font-size:14px;outline:none}
    input:focus,textarea:focus{box-shadow:0 0 0 4px rgba(37,99,235,0.08);border-color:rgba(37,99,235,0.6)}
    textarea{min-height:140px;resize:vertical}
    .row{display:flex;gap:12px}
    .muted{color:var(--muted);font-size:13px}
    .actions{display:flex;align-items:center;gap:12px;margin-top:16px}
    button{padding:10px 14px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    button[disabled]{opacity:0.6;cursor:not-allowed}
    .status{margin-top:10px;font-size:14px}
    .status .ok{color:var(--success)}
    .status .err{color:var(--danger)}
    .small{font-size:13px;color:var(--muted)}
    /* spinner */
    .spinner{display:inline-block;width:16px;height:16px;border-radius:50%;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;animation:spin 1s linear infinite;vertical-align:middle;margin-right:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    footer{margin-top:18px;font-size:12px;color:var(--muted)}
    a.inline{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="title">
    <h2 id="title">Contact us</h2>
    <p class="note">This demo sends your message to the project admin. No custom domain — working directly with SES/ApiGateway.</p>

    <label for="name">Name</label>
    <input id="name" placeholder="Your full name" autocomplete="name" />

    <label for="email">Email</label>
    <input id="email" placeholder="you@example.com" type="email" autocomplete="email" />

    <label for="message">Message</label>
    <textarea id="message" rows="6" placeholder="Type your message..."></textarea>

    <div class="actions">
      <button id="send">Send Message</button>
      <div id="spinnerWrap" style="display:none;"><span class="spinner" aria-hidden="true"></span>Sending...</div>
    </div>

    <div id="status" class="status small" role="status" aria-live="polite"></div>
    <footer class="small muted">
      Tip: open devtools (Console / Network) if something fails.
      <br>
      <a class="inline" href="#" id="openLogs" style="display:none">Open Lambda logs</a>
    </footer>
  </div>

  <script>
    // --- SET YOUR API ENDPOINT HERE ---
    // Replace with your real API Gateway invoke URL (example format):
    // const API_ENDPOINT = "https://97m3oxi3tl.execute-api.ap-south-1.amazonaws.com/Prod/submit";
    const API_ENDPOINT = "https://97m3oxi3tl.execute-api.ap-south-1.amazonaws.com/Prod/submit";

    const sendBtn = document.getElementById('send');
    const spinnerWrap = document.getElementById('spinnerWrap');
    const statusEl = document.getElementById('status');
    const openLogs = document.getElementById('openLogs');

    function setStatus(text, type) {
      statusEl.innerHTML = text || '';
      statusEl.classList.remove('err','ok');
      if (type === 'ok') statusEl.classList.add('ok');
      if (type === 'err') statusEl.classList.add('err');
    }

    function validateEmail(email) {
      // simple email check
      return /\S+@\S+\.\S+/.test(email);
    }

    sendBtn.addEventListener('click', async () => {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const message = document.getElementById('message').value.trim();

      if (!name || !email || !message) {
        setStatus('Please fill all fields.', 'err');
        return;
      }
      if (!validateEmail(email)) {
        setStatus('Please enter a valid email address.', 'err');
        return;
      }

      // UI state
      sendBtn.disabled = true;
      spinnerWrap.style.display = 'inline-block';
      setStatus('Sending...', '');

      try {
        const resp = await fetch(API_ENDPOINT, {
          method: 'POST',
          mode: 'cors',          // allow cross-origin
          cache: 'no-cache',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({name, email, message})
        });

        // If no network or CORS preflight fails, fetch will throw. If response is not OK, handle it.
        if (!resp.ok) {
          // try to read body
          let txt;
          try { txt = await resp.text(); } catch(e) { txt = resp.statusText || 'Request failed'; }
          // Show friendly message
          setStatus('Failed to send — server responded: ' + (txt || resp.status), 'err');

          // If 4xx/5xx, show link to logs (optionally)
          if (openLogs) {
            openLogs.style.display = 'inline';
            openLogs.onclick = (ev) => {
              ev.preventDefault();
              // open CloudWatch logs: user will need to adjust URL (or open via console)
              window.open('https://console.aws.amazon.com/cloudwatch/home?region=ap-south-1#logsV2:','_blank');
            };
          }
          throw new Error('Server error: ' + resp.status);
        }

        // success
        let data = {};
        try { data = await resp.json(); } catch(e) { /* ignore */ }

        const id = data && data.id ? data.id : 'n/a';
        setStatus('Message sent ✓ (id: ' + id + ')', 'ok');

        // optional: clear form
        document.getElementById('name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('message').value = '';

      } catch (err) {
        // network / CORS / parsing errors
        console.error('Send error', err);
        // If CORS preflight returned disallowed origin, browser error will be generic.
        setStatus('Failed to send — check console and network tab. ' + (err.message || ''), 'err');
      } finally {
        sendBtn.disabled = false;
        spinnerWrap.style.display = 'none';
      }
    });
  </script>
</body>
</html>
