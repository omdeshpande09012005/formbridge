<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact — FormBridge</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;padding:24px;background:#f7fafc}
    .card{max-width:680px;margin:24px auto;padding:24px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    label{display:block;margin-top:12px;font-weight:600}
    input,textarea{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #ddd}
    button{margin-top:14px;padding:10px 14px;border-radius:8px;border:none;background:#2563eb;color:#fff;font-weight:700;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    .note{font-size:13px;color:#666;margin-top:8px}
    .success{color: #065f46; font-weight:700}
    .error{color:#b91c1c; font-weight:700}
    .meta{font-size:12px;color:#555;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Contact us</h2>
    <p class="note">This demo sends your message to the project admin (backend required).</p>

    <label for="name">Name</label>
    <input id="name" placeholder="Your full name" />

    <label for="email">Email</label>
    <input id="email" placeholder="you@example.com" type="email" />

    <label for="message">Message</label>
    <textarea id="message" rows="6" placeholder="Type your message..."></textarea>

    <button id="send">Send Message</button>
    <p id="status" class="note"></p>
    <div id="meta" class="meta"></div>
  </div>

  <script>
    // ----- UPDATE THIS to your working API invoke URL -----
    const API_ENDPOINT = "https://97m3oxi3tl.execute-api.ap-south-1.amazonaws.com/Prod/submit";
    // ----------------------------------------------------

    const sendBtn = document.getElementById('send');
    const statusEl = document.getElementById('status');
    const metaEl = document.getElementById('meta');

    function setStatus(text, type='note'){
      statusEl.textContent = text;
      statusEl.className = type === 'error' ? 'error' : (type === 'success' ? 'success' : 'note');
    }

    async function postData(url, payload, timeoutMs = 15000) {
      // timeout helper
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeoutMs);

      try {
        const resp = await fetch(url, {
          method: 'POST',
          mode: 'cors',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload),
          signal: controller.signal,
        });

        clearTimeout(id);

        // We got a network-level response — attempt to parse, but be robust
        const text = await resp.text(); // read as text first
        let data = {};
        try { data = text ? JSON.parse(text) : {}; } catch(e) { data = { raw: text }; }

        return { ok: resp.ok, status: resp.status, data, respHeaders: resp.headers };
      } catch (err) {
        clearTimeout(id);
        throw err; // let caller handle
      }
    }

    sendBtn.addEventListener('click', async () => {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const message = document.getElementById('message').value.trim();

      metaEl.textContent = '';
      if (!name || !email || !message) {
        setStatus('Please fill all fields.', 'error');
        return;
      }

      sendBtn.disabled = true;
      setStatus('Sending...');

      try {
        const start = Date.now();
        const result = await postData(API_ENDPOINT, { name, email, message }, 15000);
        const elapsed = Date.now() - start;

        // Show headers (CORS / origin) if helpful
        const allowOrigin = result.respHeaders.get('Access-Control-Allow-Origin') || 'n/a';
        metaEl.textContent = `Status: ${result.status} • CORS Allow-Origin: ${allowOrigin} • ${elapsed}ms`;

        if (result.ok) {
          // Try to read returned id if present
          const id = result.data && (result.data.id || result.data.ID || result.data.Id) ? (result.data.id || result.data.ID || result.data.Id) : null;
          setStatus('Message sent ✓' + (id ? ` (id: ${id})` : ''), 'success');
          // clear form optionally
          document.getElementById('name').value = '';
          document.getElementById('email').value = '';
          document.getElementById('message').value = '';
        } else {
          // Non-2xx responses
          console.error('Server returned non-OK response', result);
          const errMsg = (result.data && result.data.error) ? result.data.error : `Status ${result.status}`;
          setStatus('Failed to send — server returned error: ' + errMsg, 'error');
        }
      } catch (err) {
        // Network / CORS / timeout
        console.error('Request failed', err);

        if (err.name === 'AbortError') {
          setStatus('Failed to send — request timed out.', 'error');
        } else {
          // Most likely CORS or network problem
          setStatus('Failed to send — network/CORS error (open devtools) .', 'error');
        }
        metaEl.textContent = `Error: ${err.message || String(err)}`;
      } finally {
        sendBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
